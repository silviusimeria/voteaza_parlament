<div class="p-4 space-y-3">
<% county.parties_with_candidates.each do |party| %>
  <div class="rounded-lg bg-white shadow-sm"
       data-controller="dropdown">
    <button data-action="click->dropdown#toggle"
            class="w-full flex items-center justify-between p-4 text-left transition-colors rounded-lg"
              style="background-color: <%= color_with_alpha(party.color, 0.1) if party.color.present? %>">
        <div class="flex items-center gap-3 w-full">
          <div class="w-1.5 h-6 rounded-full" style="background-color: <%= party.color if party.color.present? %>"></div>
          <div class="flex justify-between w-full">
            <div>
              <h3 class="text-base font-medium text-gray-900">
                <% if party.link.present? %>
                  <a href="<%= party.link %>" class="text-blue-500 underline">
                    <%= party.name %>
                  </a>
                <% else %>
                  <%= party.name %>
                <% end %>
              </h3>
            </div>
            <p class="text-sm text-gray-500">
              <%= party.candidates.count %>
            </p>
          </div>
        </div>
      </button>
      <div data-dropdown-target="content" class="hidden border-t border-gray-100">
        <%= render partial: 'candidates_list', locals: { candidates: party.candidates, party_color: party.color } %>
      </div>
    </div>
<% end %>
</div>
